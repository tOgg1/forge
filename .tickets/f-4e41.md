---
id: f-4e41
status: closed
deps: [f-c44a]
links: []
created: 2026-01-10T20:12:43Z
type: task
priority: 3
assignee: Tormod Haugland
parent: f-c2d0
---
# Clarify + enforce DM visibility semantics

The spec states: "Direct messages are stored separately and only visible to the recipient." With a file-based store, we need to define what this means in practice.

Scope:
- Define DM visibility rules:
  - Should `fmail log @other` be allowed or blocked?
  - How does this interact with FMAIL_AGENT being unset / anon?
  - What is the threat model (same-user processes vs multi-user shared filesystem)?
- Implement best-effort enforcement:
  - Create dm/<agent>/ directories with restrictive permissions
  - Create DM message files with restrictive permissions
  - Enforce CLI checks so only the recipient can read/watch their DM inbox by default

References:
- docs/forge-mail/SPEC.md (Direct Messages)
- docs/forge-mail/DESIGN.md (threat model)

## Acceptance Criteria

- DM directory/file permissions are restrictive by default
- By default, fmail refuses to read/watch another agent's DM inbox unless an explicit override is provided (decide the override mechanism)
- Behavior is documented (either in docs or in this ticket)
- Covered by unit tests where feasible


## Notes

**2026-01-11T09:03:15Z**

Added DM inbox access checks with --allow-other-dm override, tightened DM perms to 0700/0600, updated docs/tests. go test ./... failed in sandbox (go-build cache permission + httptest listener).
