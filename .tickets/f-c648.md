---
id: f-c648
status: open
deps: [f-f710, f-e441, f-cd1f, f-5633]
links: []
created: 2026-01-10T20:10:49Z
type: task
priority: 1
assignee: Tormod Haugland
parent: f-c2d0
---
# Implement fmail connected mode (auto-connect + fallback)

Implement the client-side integration so fmail can transparently use forged when available.

Scope:
- Connection discovery:
  - Prefer unix socket at .fmail/forged.sock (if present)
  - Fallback to TCP localhost:7463 (if enabled by design)
- For send:
  - If connected: send via JSON-lines protocol and do not write directly
  - If not connected: fallback to standalone write
- For watch:
  - If connected: stream messages in realtime
  - If not connected: fallback to polling implementation
- Define and implement failure behavior:
  - Clear errors for protocol failures
  - Automatic fallback to standalone when appropriate

References:
- docs/forge-mail/SPEC.md (Two Modes + Forged Integration)

## Acceptance Criteria

- With forged running, `fmail send` uses the server path and still results in a message file on disk
- With forged running, `fmail watch` receives messages in realtime (no polling)
- Without forged running, commands behave as standalone mode
- Fallback behavior is deterministic and documented (e.g., connection refused -> standalone)

